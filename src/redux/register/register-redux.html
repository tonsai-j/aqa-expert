<script>
    Nylon.addReducer('register', function (state, action) {
        state = state || {
            typeAssessor: [],
            isCard: false,
            info: {}
        }

        switch (action.type) {
            case 'REGISTER_GET_TYPE_ASSESSOR':
                state.typeAssessor = action.payload
                return state
            case 'REGISTER_INFO':
                state.isCard = action.isCard;
                state.info = action.info;
                return state;
            default:
                return state
        }
        return state
    })


    Nylon.addAction({
        REGISTER_GET_TYPE_ASSESSOR: function () {
            return dispatch =>
                axios.get('/type/assessor').then(
                    res => {
                        dispatch({ type: 'REGISTER_GET_TYPE_ASSESSOR', payload: res.data })
                    }
                )
        },
        REGISTER_POST: function (data) {
            var progress = Nylon.$['page-register'].$.panelCard.progress({ position: 'top' })
            return dispatch =>
                axios.post('/register', data).then(
                    res => {
                        progress(() => {
                            Nylon.dispatch('PROFILE_LOGIN', res.data)
                        })
                    }
                )
        },
        REGISTER_READER_CARD: function (callback) {
            return dispatch =>
                axios.get('http://127.0.0.1:1119/info?p=0').then(
                    res => {
                        if (res.data.Data.cardInfo.cardId) {
                            dispatch({ type: 'REGISTER_INFO', isCard: true, info: res.data.Data.cardInfo })
                            callback();
                        } else {
                            dispatch({ type: 'REGISTER_INFO', isCard: false, info: {} })
                            callback();
                        }
                    }
                ).catch(err => {
                    dispatch({ type: 'REGISTER_INFO', isCard: false, info: {} })
                    callback();
                })
        }
    })

</script>