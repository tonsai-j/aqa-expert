<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../components/nylon-rating/nylon-rating.html">
<link rel="import" href="../../../layout/flexbox-grid.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../components/aqa-form/aqa-combo-box.html">
<link rel="import" href="../../../components/aqa-panel/aqa-panel.html">
<link rel="import" href="../../../components/aqa-button/aqa-button.html">
<link rel="import" href="../../../components/aqa-form/aqa-input.html">
<link rel="import" href="./components/skill-form.html">
<link rel="import" href="../../../components/aqa-font/aqa-trirong-font.html">
<link rel="import" href="../../../components/aqa-font/aqa-mitr-font.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../components/aqa-title/aqa-title-name.html">
<link rel="import" href="../../../my-icons.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../nylon-i18n.html">
<link rel="import" href="../../../i18n/profile/page-06-i18n.html">
<link rel="import" href="../../../redux-mixin.html">
<link rel="import" href="../../../mixins/animate-mixin.html">
<link rel="import" href="../../../mixins/common-mixin.html">
<link rel="import" href="../../../../bower_components/paper-toast/paper-toast.html"> -->


<link rel="import" href="../../../redux/profile/page-06-redux.html">


<dom-module id="page-06">
    <template>
        <style include="flexbox-grid shared-styles">
            .section {
                margin: 0.5rem;
            }

            .section-header {
                margin-bottom: 1rem;
                font-size: 1.2rem;
            }

            .section-content {
                margin-left: 1.5rem;
            }

            .textRight {
                text-align: right;
            }

            .textLeft {
                text-align: left;
            }

            .white-space {
                margin: 1rem;
            }

            h2 {
                font-family: MitrRegular;
                font-weight: normal;
            }
        </style>
        <div class="page-container">
            <aqa-title-name item=[[info]]></aqa-title-name>
            <div class="row">
                <div class="white-space"></div>
                <div class="col-xs-12">
                    <aqa-panel id="card basic">
                        <app-toolbar slot="header">
                            <div main-title>[[i18n.page06.title_2]]</div>
                        </app-toolbar>
                        <div slot="content">
                            <div>
                                <skill-form name="1" items="{{computerList}}" skilllev="{{skilllev}}"></skill-form>
                            </div>
                        </div>
                    </aqa-panel>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="white-space"></div>
                    <aqa-panel id="card basic">
                        <app-toolbar slot="header">
                            <div main-title>[[i18n.page06.title_3]]ความสามารถด้านการพิมพ์</div>
                        </app-toolbar>
                        <div slot="content">
                            <div>
                                <skill-form name="2" items="{{typewritingList}}" skilllev="{{skilllev}}"></skill-form>
                            </div>
                        </div>
                    </aqa-panel>
                </div>
                <div class="col-xs-12">
                    <div class="white-space"></div>
                    <aqa-panel id="card basic">
                        <app-toolbar slot="header">
                            <div main-title>[[i18n.page06.title_4]]ความสามารถด้านภาษา</div>
                        </app-toolbar>
                        <div slot="content">
                            <div>
                                <skill-form name="2" items="{{languageList}}" skilllev="{{skilllev}}"></skill-form>
                                <!-- <div class="row">
                                    <div class="start-xs end-md col-xs-12 col-md-4" style="margin:auto 0">
                                        อื่นๆ
                                    </div>
                                    <div class="col-xs-12 col-md-5">
                                        <aqa-combo-box items="[[alllanguage]]" placeholder="เลือก" item-label-path="label" item-value-path="label" value="{{selectLanguage}}"></aqa-combo-box>
                                    </div>
                                    <div class="col-xs-3"></div>
                                </div> -->
                            </div>
                        </div>
                    </aqa-panel>
                </div>
            </div>
            <div style="margin:1rem"></div>
            <div class="row center-xs">
                <div class="col-lg-2">
                    <div style="padding:0rem 2rem;">
                        <aqa-button type="success btn-full-width" on-tap="_save">[[i18n.button.save.label]]</aqa-button>
                    </div>
                </div>
            </div>
        </div>

        <paper-toast id="toast" horizontal-align="right" vertical-align="bottom" text="[[i18n.toast.save]]"></paper-toast>

    </template>

    <script>
        /**
         * `page-06` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class Page06 extends AnimateMixin(CommonMixin(ReduxMixin(Polymer.Element))) {
            /**
             * String providing the tag name to profile the element under.
             */
            static get is() {
                return 'page-06';
            }

            /**
             * Object describing property-related metadata used by Polymer features
             */
            static get properties() {
                return {
                    i18n: {
                        type: Object,
                        statePath: 'i18n',
                    },
                    info: {
                        type: Object,
                        statePath: 'profile.info'
                    },
                    data: {
                        type: Object,
                        statePath: 'profile.info.skills',
                    },
                    skilllev: {
                        type: Object,
                        statePath: 'profile_page06.skilllev',
                    },
                    computerList: {
                        type: Array,
                        value: []
                    },
                    computer: {
                        type: Array,
                        statePath: 'profile_page06.skillcom',
                        // observer: 'setComputer'
                    },
                    languageList: {
                        type: Array,
                        value: []
                    },
                    language: {
                        statePath: 'profile_page06.skilllang',
                        // observer: 'setLanguage'
                    },
                    typewritingList: {
                        type: Array,
                        value: []
                    },
                    typewriting: {
                        statePath: 'profile_page06.skilltypewriting',
                        // observer: 'setTypeWriting'
                    },
                    print: {
                        type: Array,
                        value: [
                            {
                                id: 1,
                                label: 'ภาษาไทย',
                                value: 3
                            },
                            {
                                id: 2,
                                label: 'ภาษาอังกฤษ',
                                value: 3
                            }
                        ]
                    },
                    list: {
                        type: Array,
                        value: function () {
                            var obj = []
                            for (var index = 0; index <= 50; index++) {
                                if (index == 0) obj.push({ label: 'ไม่มีประสบการณ์', value: index })
                                else obj.push({ label: index, value: index })
                            }
                            return obj;
                        }
                    }
                };
            }
            static get observers() {
                return [
                    // Observer method name, followed by a list of dependencies, in parenthesis
                    'setData(info, computer,language,typewriting)'
                ]
            }
            /**
             * Instance of the element is created/upgraded. Use: initializing state,
             * set up event listeners, create shadow dom.
             * @constructor
             */
            constructor() {
                super();
            }

            /**
             * Use for one-time configuration of your component after local DOM is initialized. 
             */
            ready() {
                super.ready();
                var elem = this.$.skills
                //this.fadeInDown(elem, 1, 300)
                Nylon.dispatch('PROFILE_06_GET_TYPE_SKILL')
                // console.log(111);
            }
            isUndefined(check) {
                return check !== undefined
            }
            setData(info, computer, language, typewriting) {
                const setData = (arr, dataValue) => {
                    if (!this.isUndefined(dataValue))
                        return ''
                    let newDataCom = []
                    arr.map((item, index) => {
                        let check = dataValue.find(itemsub => itemsub.REFCODE === item.REFCODE)
                        // console.log(check.value);
                        if (this.isUndefined(check)) {
                            item.value = check.value
                        }else {
                            item.value = ''
                        }
                    })
                    return arr
                    // this.set(dataSet, newDataCom)
                }
                if (this.isUndefined(info) && this.isUndefined(computer) &&
                    this.isUndefined(language) && this.isUndefined(typewriting)) {
                    // console.log(info, computer, language, typewriting);
                    // console.log(setData(computer, info.skills));
                    this.set('computerList',setData(computer, info.skills))
                    this.set('languageList',setData(language, info.skills))
                    this.set('typewritingList',setData(typewriting, info.skills))
                    //                     computerList
                    // languageList
                    // typewritingList
                }

            }
            // setComputer(com) {
            //     if (com.length < 1)
            //         return
            //     let newDataCom = com.map(item => {
            //         item.value = ''
            //         return item
            //     })
            //     this.set('computerList', newDataCom)
            // }
            // setLanguage(language) {
            //     if (language.length < 1)
            //         return
            //     let newDataCom = language.map(item => {
            //         item.value = ''
            //         return item
            //     })
            //     this.set('languageList', newDataCom)
            // }
            // setTypeWriting(TypeWriting) {
            //     if (TypeWriting.length < 1)
            //         return
            //     let newDataCom = TypeWriting.map(item => {
            //         item.value = ''
            //         return item
            //     })
            //     this.set('typewritingList', newDataCom)
            // }
            _getDecodeData(data) {
                // console.log(this.computerList);
                let dataForSave = []
                data.map(item => {
                    dataForSave.push({
                        REFCODE: item.REFCODE,
                        REFDESC1: item.REFDESC1,
                        REFGROUP: item.REFGROUP,
                        id: item.id,
                        value: item.value
                    })
                    return item
                })
                return dataForSave
            }
            _save() {
                let computerList = this._getDecodeData(this.computerList)
                let languageList = this._getDecodeData(this.languageList)
                let typewritingList = this._getDecodeData(this.typewritingList)
                let dataForSave = computerList.concat(languageList.concat(typewritingList))
                // console.log(this._getDecodeData(this.computerList))
                // console.log(this._getDecodeData(this.languageList))
                // console.log(dataForSave);
                // console.log(this.info.id);
                // var req = this.shadowRoot.querySelectorAll('.required-radio')
                // for (var i = 0; i < req.length; i++) {
                //     if (typeof req[i].selectedItem === 'undefined')
                //         req[i].selectIndex(3)
                // }
                // // console.log(this.data)
                // if (this.validateForm('.required')) {
                //     for (var head in this.data) {
                //         for (var sub in this.data[head]) {
                //             this.data[head][sub] = Number(this.data[head][sub])
                //         }
                //     }
                Nylon.dispatch('PROFILE_UPDATE', this.info.id, 'skills', dataForSave,
                    () => {
                        Nylon.dialog('save')
                    }
                );
                // } else {
                //     Nylon.toast('required')
                // }


            }
        }

        window.customElements.define(Page06.is, Page06);
    </script>
</dom-module>