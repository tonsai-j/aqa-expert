<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../../bower_components/vaadin-grid/vaadin-grid-column.html">

<link rel="import" href="../../components/nylon-panel-card/nylon-panel-card.html">
<link rel="import" href="../../components/nylon-c3/nylon-c3.html">

<link rel="import" href="../../redux-mixin.html">
<link rel="import" href="../../redux/dashboard/dashboard-redux.html">
<link rel="import" href="../../layout/shared-styles.html">



<dom-module id="page-dashboard">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      .container-dashboard {
        background-color: #3399ff;
      }

      nylon-panel-card {
        margin: 5px
      }
    </style>

    <div class="container">
      <div class="row user">
        <div class="col-xs-4">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้สำเร็จการศึกษาที่ได้งานทำ / ศึกษาต่อ</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart"></nylon-c3>
          </nylon-panel-card>
        </div>
        <div class="col-xs-5">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>อัตรส่วนของครู : ผู้เรียน</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart2"></nylon-c3>
          </nylon-panel-card>
        </div>
        <div class="col-xs-3">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>โครงการนวัตกรรม / สิ่งประดิษฐ์</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart3"></nylon-c3>
          </nylon-panel-card>
        </div>
        <div class="col-xs-4">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผลการประเมินตนเอง (SAR)</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart4"></nylon-c3>
          </nylon-panel-card>
        </div>

        <div class="col-xs-8">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เรียนที่ผ่านการประเมินสมรรถนะ ตามมาตราฐานวิชาชีพ</div>
            </app-toolbar>
            <vaadin-grid id="chart5" slot="content" sub-slot="grid">
              <vaadin-grid-column width="360px">
                <template class="header">&nbsp;</template>
                <template> [[item.name]] </template>
              </vaadin-grid-column>
              <vaadin-grid-column>
                <template class="header">ปวช.</template>
                <template> [[item.price]] </template>
              </vaadin-grid-column>
              <vaadin-grid-column>
                <template class="header">ปวส.</template>
                <template> [[item.edu2]] </template>
              </vaadin-grid-column>
            </vaadin-grid>
          </nylon-panel-card>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row admin">
        <div class="col-xs-6 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ค่าใช้จ่ายโดยรวม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart1_admin"></nylon-c3>
          </nylon-panel-card>
        </div>


        <div class="col-xs-6 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เข้าอบรม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart2_admin"></nylon-c3>
          </nylon-panel-card>
        </div>


        <div class="col-xs-12 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>สรุปผลการประเมินสถานศึกษา</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart3_admin"></nylon-c3>
          </nylon-panel-card>
        </div>


        <div class="col-xs-12">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>สรุปผลการประเมินสถานศึกษา</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart4_admin"></nylon-c3>
          </nylon-panel-card>
        </div>


        <!-- <div class="col-xs-3 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เข้าอบรม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart3_admin"></nylon-c3>
          </nylon-panel-card>
        </div>

        <div class="col-xs-3 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เข้าอบรม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart4_admin"></nylon-c3>
          </nylon-panel-card>
        </div>

        <div class="col-xs-3 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เข้าอบรม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart5_admin"></nylon-c3>
          </nylon-panel-card>
        </div>

        <div class="col-xs-3 ">
          <nylon-panel-card>
            <app-toolbar slot="header">
              <div main-title>ผู้เข้าอบรม</div>
            </app-toolbar>
            <nylon-c3 slot="content" id="chart6_admin"></nylon-c3>
          </nylon-panel-card>
        </div> -->

      </div>
    </div>
  </template>

  <script>
    class PageDashboard extends ReduxMixin(Polymer.Element) {
      static get is() { return 'page-dashboard' }
      static get properties() {
        return {
          role: {
            type: String,
            value: 'admin'
          },
          expenses: {
            type: Object,
            statePath: 'dashboard.expenses',
            observer: 'expenses_change'
          }
        }

      }
      connectedCallback() {
        super.connectedCallback()


        if (this.role == 'admin') {
          console.log('admin')
          Nylon.dispatch('DASHBOARD_GET_EXPENSES')
          this.shadowRoot.querySelector('.user').style.display = 'none'

        } else if (this.role == 'user') {
          Nylon.dispatch('DASHBOARD_GET_EXPENSES')
          console.log('user')
          this.shadowRoot.querySelector('.admin').style.display = 'none'

        }
      }

      expenses_change(e) {
        console.log(e)

        var columns = []
        var expenses_list = []

        for (var i in e) {
          if (e[i].amount != 0) {
            columns.push([e[i].group_expenses_name + ' ' + e[i].price + '฿', Number(e[i].percentage.toFixed(2))])

          }
          expenses_list.push({
            name: e[i].group_expenses_name,
            percentage: Number(e[i].percentage.toFixed(2)),
            price: e[i].price,
            amount: e[i].amount
          })
        }


        this.$.chart1_admin.generate({
          data: {
            columns,
            type: 'pie',
            onclick: function (d, i) { console.log("onclick", d, i); }
          },
          size: {
            height: 250
          }
        })


        this.$.chart2_admin.generate({
          data: {
            x: 'x',
            columns: [
              ['x', '2559', '2560', '2561', '2562', '2563', '2564'],
              ['เชิญ', 30, 200, 100, 200, 150, 140],
              ['ตอบรับ', 130, 100, 140, 200, 150, 50],
              ['เข้าร่วม', 130, 100, 140, 200, 150, 50]
            ],
            type: 'bar'

          },
          bar: {
            width: {
              ratio: 0.5
            }
          },
          size: {
            height: 250
          }

        })

        // this.$.chart3_admin.generate({
        //   data: {
        //     x: 'x',
        //     columns: [
        //       ['x','2559', '2560', '2561', '2562', '2563', '2564'],
        //       ['สถานศึกษาที่ต้องเข้ารับการประเมิน', 3000, 3200,3500, 3300, 3800, 3100],
        //       ['ได้รับการประเมินแล้ว', 2800, 3100, 2700, 2900, 3500, 3000]
        //     ],
        //     type: 'bar'

        //   },
        //   bar: {
        //     width: {
        //       ratio: 0.5
        //     }
        //   },
        //   size: {
        //     height: 250
        //   }

        // })


        // this.$.chart3_admin.generate({
        //   data: {
        //     x: 'x',
        //     columns: [
        //       ['x', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม'],
        //       ['สถานศึกษาที่ต้องเข้ารับการประเมิน', 3000, 3200, 3500, 3300, 3800, 3100],
        //       ['ได้รับการประเมินแล้ว', 2800, 3100, 2700, 2900, 3500, 3000]
        //     ],
        //     type: 'bar'
        //   },
        //   axis: {
        //     x: {
        //       type: 'category',
        //       tick: {
        //         rotate: 0,
        //         multiline: false
        //       },
        //     }
        //   }
        // })

        this.$.chart3_admin.generate({
          data: {
            columns: [
              // ['x', '2558', '2559', '2560', '2561'],
              ['ดีมาก', 30, 200, 100, 400],
              ['ดี', 40, 100, 140, 200],
              ['พอใช้', 50, 200, 100, 400],
              ['ต้องปรับปรุง', 60, 100, 140, 200],
              ['ต้องปรับปรุงเร่งด่วน', 70, 100, 140, 200]
            ],
            //  type: 'spline'
          },
          axis: {
            x: {
              type: 'category',
              categories: ['ปี 2558', 'ปี 2559', 'ปี 2560', 'ปี 2561']
            }
          },
          size: {
            height: 250
          }
        })


        this.$.chart4_admin.generate({
          data: {
            columns: [
              // ['x', '2558', '2559', '2560', '2561'],
              ['percent', 70, 60, 55,50,30,10]
            ],
            //  type: 'spline'
          },
          axis: {
            x: {
              type: 'category',
              categories: ['จัดกลุ่ม', 'ส่งแผนการดำเนินงาน', 'เข้าประเมินสถานศึกษา', 'ตรวจร่างรายงาน', 'อภิมาน', 'ส่งรายงานฉบับสมบูรณ์']
            }
          },
          size: {
            height: 250
          }
        })



      }
    }

    window.customElements.define(PageDashboard.is, PageDashboard);
  </script>
</dom-module>